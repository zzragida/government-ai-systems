<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒ‰ìƒ ì½”ë“œ + OCR í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Noto Sans KR', sans-serif; }
        :root {
            --gov-blue: #0046FF;
            --gov-navy: #1e3a5f;
            --gov-gray: #6B7280;
            --gov-bg: #F8F9FA;
        }
        body { background: var(--gov-bg); color: #1F2937; }
        
        header {
            background: white;
            border-bottom: 3px solid var(--gov-blue);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
        }
        
        .logo-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #FF6B6B 0%, #4ECDC4 50%, #FFE66D 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: white;
            box-shadow: 0 4px 12px rgba(0,70,255,0.3);
        }
        
        .logo-text h1 { font-size: 1.75rem; font-weight: 700; color: var(--gov-navy); }
        .logo-text p { font-size: 0.875rem; color: var(--gov-gray); }
        
        .header-buttons { display: flex; gap: 1rem; }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary { background: var(--gov-blue); color: white; }
        .btn-primary:hover { background: #0033CC; }
        .btn-secondary { background: white; color: var(--gov-blue); border: 2px solid var(--gov-blue); }
        .btn-secondary:hover { background: #E8F0FF; }
        
        .container { max-width: 1800px; margin: 0 auto; padding: 2rem; }
        
        .concept-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 16px;
            padding: 3rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        }
        
        .concept-section h2 { font-size: 2rem; margin-bottom: 1rem; }
        .concept-section p { font-size: 1.125rem; line-height: 1.8; }
        
        .mode-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .mode-btn {
            flex: 1;
            padding: 1.5rem;
            background: white;
            border: 3px solid #E5E7EB;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .mode-btn:hover { border-color: var(--gov-blue); }
        .mode-btn.active { border-color: var(--gov-blue); background: #E8F0FF; }
        
        .mode-btn h3 { color: var(--gov-navy); margin-bottom: 0.5rem; }
        .mode-btn p { color: var(--gov-gray); font-size: 0.875rem; }
        
        .editor-section {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 2rem;
        }
        
        .editor-panel {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .panel-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gov-navy);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .text-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gov-blue);
            border-radius: 8px;
            font-size: 1.125rem;
            margin-bottom: 1.5rem;
            font-family: 'Noto Sans KR', sans-serif;
        }
        
        .color-palette {
            display: grid;
            grid-template-columns: repeat(16, 1fr);
            gap: 0.25rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--gov-bg);
            border-radius: 8px;
        }
        
        .color-box {
            aspect-ratio: 1;
            border-radius: 4px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
        }
        
        .color-box:hover { transform: scale(1.2); box-shadow: 0 2px 8px rgba(0,0,0,0.3); z-index: 10; }
        .color-box.selected { border-color: #FFD700; box-shadow: 0 0 8px rgba(255,215,0,0.8); }
        .color-box.base-color { border: 3px solid #FFD700; box-shadow: 0 0 12px rgba(255,215,0,1); }
        
        .colored-text-display {
            min-height: 200px;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            border: 2px solid #E5E7EB;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .colored-char {
            display: inline-block;
            font-size: 3.5rem;
            font-weight: 900;
            padding: 0.5rem;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Noto Sans KR', sans-serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        
        .colored-char:hover { transform: scale(1.15); text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .colored-char.base { border: 3px solid #FFD700; border-radius: 8px; background: #FFF9E6; box-shadow: 0 0 12px rgba(255,215,0,0.5); }
        
        .ipv6-display {
            background: #1e293b;
            color: #10b981;
            padding: 1.5rem;
            border-radius: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.125rem;
            word-break: break-all;
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }
        
        .address-breakdown {
            background: var(--gov-bg);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }
        
        .breakdown-item {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--gov-blue);
        }
        
        .breakdown-label {
            font-weight: 600;
            color: var(--gov-navy);
            min-width: 120px;
        }
        
        .breakdown-value {
            font-family: 'JetBrains Mono', monospace;
            color: var(--gov-blue);
            font-weight: 600;
            word-break: break-all;
        }
        
        .comparison-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        
        .comparison-table table { width: 100%; border-collapse: collapse; }
        .comparison-table th { background: var(--gov-blue); color: white; padding: 1rem; text-align: left; }
        .comparison-table td { padding: 1rem; border-bottom: 1px solid #E5E7EB; }
        .comparison-table tr:hover { background: #F9FAFB; }
        
        .info-box {
            background: #E8F0FF;
            border-left: 4px solid var(--gov-blue);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .highlight { background: #FEF3C7; padding: 0.25rem 0.5rem; border-radius: 4px; font-weight: 600; }
        
        @media (max-width: 1200px) {
            .editor-section { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <!-- ë°ëª¨ ë°°ë„ˆ -->
        <div style="background:#4B5563;color:white;padding:12px;display:flex;justify-content:space-between;align-items:center;">
        <p style="font-size:14px;font-weight:600;margin:0;">âš ï¸ ë³¸ ì‚¬ì´íŠ¸ëŠ” OpenHash ê¸°ìˆ ì˜ ì‹¤ì¦ì„ ìœ„í•œ ë°ëª¨ ì‹œìŠ¤í…œì…ë‹ˆë‹¤ (ì‹¤ì œ ì •ë¶€ ì„œë¹„ìŠ¤ ì•„ë‹˜)</p>
        <div style="display:flex;gap:20px;">
            <a href="http://100.30.14.224/openhash-system/" style="color:white;text-decoration:none;font-size:14px;font-weight:600;display:flex;align-items:center;gap:4px;">
                <span>Openhash</span>
                <i class="fas fa-question-circle" style="font-size:16px;"></i>
            </a>
            <a href="http://100.30.14.224/national-data-registry/" style="color:white;text-decoration:underline;font-size:14px;font-weight:600;">êµ­ê°€ ë°ì´í„°ì²˜</a>
        </div>
    </div>
    <header>
        <div class="header-content">
            <div class="logo" onclick="location.href='/portal/systems.html'">
                <div class="logo-icon">
                    <i class="fas fa-palette"></i>
                </div>
                <div class="logo-text">
                    <h1>ìƒ‰ìƒ ì½”ë“œ + OCR í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œ</h1>
                    <p>ì´ì¤‘ ì¸ì½”ë”©ìœ¼ë¡œ ì •ë³´ ë°€ë„ ê·¹ëŒ€í™”</p>
                </div>
            </div>
            <div class="header-buttons">
                <a href="/color-code/analysis.html" class="btn btn-secondary">
                    <i class="fas fa-chart-bar"></i>
                    ë¹„êµ ë¶„ì„
                </a>
                <a href="/portal/systems.html" class="btn btn-secondary">
                    <i class="fas fa-home"></i>
                    í¬í„¸
                </a>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- ê°œë… ì„¤ëª… -->
        <div class="concept-section">
            <h2><i class="fas fa-brain"></i> ìƒ‰ìƒ ì½”ë“œ + OCR í•˜ì´ë¸Œë¦¬ë“œ ì¸ì½”ë”©</h2>
            <p>
                <strong>ìƒ‰ìƒ ì •ë³´</strong>ì™€ <strong>ë¬¸ì ì •ë³´</strong>ë¥¼ ë™ì‹œì— ì¸ì½”ë”©í•˜ì—¬ 
                IPv6 ì£¼ì†Œ í•˜ë‚˜ì— í›¨ì”¬ ë” ë§ì€ ì •ë³´ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.
            </p>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-top: 1.5rem;">
                <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 12px;">
                    <h3><i class="fas fa-palette"></i> ìƒ‰ìƒ ë ˆì´ì–´</h3>
                    <p>ê° ê¸€ìì˜ ìƒ‰ìƒ (64ìƒ‰ = 6ë¹„íŠ¸)</p>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 12px;">
                    <h3><i class="fas fa-text"></i> ë¬¸ì ë ˆì´ì–´</h3>
                    <p>OCRë¡œ ì¸ì‹í•œ ìœ ë‹ˆì½”ë“œ (16ë¹„íŠ¸)</p>
                </div>
                <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 12px;">
                    <h3><i class="fas fa-layer-group"></i> í•˜ì´ë¸Œë¦¬ë“œ</h3>
                    <p>ìƒ‰ìƒ + ë¬¸ì = 22ë¹„íŠ¸/ê¸€ì</p>
                </div>
            </div>
        </div>

        <!-- ëª¨ë“œ ì„ íƒ -->
        <div class="mode-selector">
            <div class="mode-btn active" onclick="setMode('color')" id="modeColor">
                <h3><i class="fas fa-palette"></i> ìƒ‰ìƒ ì „ìš© ëª¨ë“œ</h3>
                <p>64ìƒ‰ ì‹œìŠ¤í…œ (6ë¹„íŠ¸/ê¸€ì)</p>
            </div>
            <div class="mode-btn" onclick="setMode('ocr')" id="modeOCR">
                <h3><i class="fas fa-eye"></i> OCR ì „ìš© ëª¨ë“œ</h3>
                <p>ìœ ë‹ˆì½”ë“œ í…ìŠ¤íŠ¸ (16ë¹„íŠ¸/ê¸€ì)</p>
            </div>
            <div class="mode-btn" onclick="setMode('hybrid')" id="modeHybrid">
                <h3><i class="fas fa-layer-group"></i> í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ</h3>
                <p>ìƒ‰ìƒ + OCR (22ë¹„íŠ¸/ê¸€ì)</p>
            </div>
        </div>

        <!-- í¸ì§‘ê¸° -->
        <div class="editor-section">
            <!-- ì™¼ìª½: ì…ë ¥ ë° ìƒ‰ìƒ ì„ íƒ -->
            <div class="editor-panel">
                <div class="panel-title">
                    <i class="fas fa-edit"></i>
                    <span id="editorTitle">ìƒ‰ìƒ ì½”ë“œ í¸ì§‘ê¸°</span>
                </div>
                
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--gov-navy);">
                    <i class="fas fa-keyboard"></i> í…ìŠ¤íŠ¸ ì…ë ¥ (ìµœëŒ€ 10ê¸€ì)
                </label>
                <div style="display: flex; gap: 0.5rem;">
                    <input 
                        type="text" 
                        id="textInput" 
                        class="text-input" 
                        placeholder="ì˜ˆ: ìƒˆë§ˆì„, ì œì£¼ë„ì²­, Hello..."
                        maxlength="10"
                        style="flex: 1; margin-bottom: 0;"
                    />
                    <button 
                        class="btn btn-primary" 
                        onclick="autoColorByAI()"
                        id="aiColorBtn"
                        style="white-space: nowrap; margin-bottom: 1.5rem;"
                        title="AIê°€ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ ìµœì ì˜ ìƒ‰ìƒì„ ìë™ í• ë‹¹í•©ë‹ˆë‹¤"
                    >
                        <i class="fas fa-wand-magic-sparkles"></i>
                        AI ìë™ ìƒ‰ìƒ
                    </button>
                </div>
                
                <div class="info-box" id="modeInfo">
                    <strong>ğŸ’¡ ìƒ‰ìƒ ì „ìš© ëª¨ë“œ:</strong><br>
                    ê° ê¸€ìì— 64ìƒ‰ ì¤‘ í•˜ë‚˜ë¥¼ í• ë‹¹í•˜ì—¬ IPv6 ì£¼ì†Œ ìƒì„±
                </div>
                
                <div id="colorPaletteSection">
                    <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--gov-navy);">
                        <i class="fas fa-palette"></i> 64ìƒ‰ íŒ”ë ˆíŠ¸
                    </label>
                    <div class="color-palette" id="colorPalette"></div>
                </div>
                
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--gov-navy);">
                    <i class="fas fa-paint-roller"></i> ë¯¸ë¦¬ë³´ê¸°
                </label>
                <div class="colored-text-display" id="coloredText">
                    <div style="color: var(--gov-gray); padding: 3rem;">
                        ìœ„ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”
                    </div>
                </div>
            </div>

            <!-- ì˜¤ë¥¸ìª½: IPv6 ê²°ê³¼ -->
            <div class="editor-panel">
                <div class="panel-title">
                    <i class="fas fa-network-wired"></i>
                    IPv6 ì£¼ì†Œ ë° ë¶„ì„
                </div>
                
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--gov-navy);">
                    <i class="fas fa-code"></i> ìƒì„±ëœ IPv6 ì£¼ì†Œ
                </label>
                <div class="ipv6-display" id="ipv6Output">
                    <div style="text-align: center; opacity: 0.5;">
                        í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ë©´<br>IPv6 ì£¼ì†Œê°€ ìƒì„±ë©ë‹ˆë‹¤
                    </div>
                </div>
                
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--gov-navy);">
                    <i class="fas fa-info-circle"></i> ì¸ì½”ë”© ìƒì„¸
                </label>
                <div class="address-breakdown" id="addressBreakdown">
                    <div style="text-align: center; color: var(--gov-gray);">
                        ì¸ì½”ë”© ìƒì„¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                    </div>
                </div>
                
                <label style="display: block; font-weight: 600; margin-bottom: 0.5rem; color: var(--gov-navy);">
                    <i class="fas fa-chart-line"></i> ì •ë³´ ë°€ë„ ë¹„êµ
                </label>
                <div class="comparison-table">
                    <table>
                        <thead>
                            <tr>
                                <th>ëª¨ë“œ</th>
                                <th>ë¹„íŠ¸/ê¸€ì</th>
                                <th>ì£¼ì†Œ ìˆ˜ (4ê¸€ì)</th>
                            </tr>
                        </thead>
                        <tbody id="comparisonBody">
                            <tr>
                                <td colspan="3" style="text-align: center; color: var(--gov-gray);">í…ìŠ¤íŠ¸ ì…ë ¥ í›„ ë¹„êµ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <button class="btn btn-primary" style="width: 100%; margin-top: 1.5rem; justify-content: center; font-size: 1.125rem;" onclick="copyIPv6()">
                    <i class="fas fa-copy"></i>
                    IPv6 ì£¼ì†Œ ë³µì‚¬
                </button>
            </div>
        </div>
    </div>

    <script>
        // 64ìƒ‰ íŒ”ë ˆíŠ¸
        const colors = [];
        for (let i = 0; i < 64; i++) {
            const r = ((i >> 4) & 0x3) * 85;
            const g = ((i >> 2) & 0x3) * 85;
            const b = (i & 0x3) * 85;
            const hex = '#' + r.toString(16).padStart(2, '0') + g.toString(16).padStart(2, '0') + b.toString(16).padStart(2, '0');
            colors.push({ hex: hex.toUpperCase(), index: i, isBase: i === 32 });
        }

        const BASE_COLOR_INDEX = 32;
        let currentMode = 'color'; // 'color', 'ocr', 'hybrid'
        let textChars = [];
        let selectedCharIndex = null;

        // ëª¨ë“œ ì „í™˜
        function setMode(mode) {
            currentMode = mode;
            
            // UI ì—…ë°ì´íŠ¸
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('mode' + mode.charAt(0).toUpperCase() + mode.slice(1)).classList.add('active');
            
            // íŒ”ë ˆíŠ¸ í‘œì‹œ/ìˆ¨ê¹€
            const paletteSection = document.getElementById('colorPaletteSection');
            if (mode === 'ocr') {
                paletteSection.style.display = 'none';
            } else {
                paletteSection.style.display = 'block';
            }
            
            // ì •ë³´ ë°•ìŠ¤ ì—…ë°ì´íŠ¸
            const infoBox = document.getElementById('modeInfo');
            if (mode === 'color') {
                infoBox.innerHTML = '<strong>ğŸ’¡ ìƒ‰ìƒ ì „ìš© ëª¨ë“œ:</strong><br>ê° ê¸€ìì— 64ìƒ‰ ì¤‘ í•˜ë‚˜ë¥¼ í• ë‹¹í•˜ì—¬ IPv6 ì£¼ì†Œ ìƒì„± (6ë¹„íŠ¸/ê¸€ì)';
            } else if (mode === 'ocr') {
                infoBox.innerHTML = '<strong>ğŸ’¡ OCR ì „ìš© ëª¨ë“œ:</strong><br>ê¸€ìì˜ ìœ ë‹ˆì½”ë“œë§Œ ì‚¬ìš©í•˜ì—¬ IPv6 ì£¼ì†Œ ìƒì„± (16ë¹„íŠ¸/ê¸€ì)';
            } else {
                infoBox.innerHTML = '<strong>ğŸ’¡ í•˜ì´ë¸Œë¦¬ë“œ ëª¨ë“œ:</strong><br>ìƒ‰ìƒ(6ë¹„íŠ¸) + ìœ ë‹ˆì½”ë“œ(16ë¹„íŠ¸) = 22ë¹„íŠ¸/ê¸€ìë¡œ ìµœëŒ€ ì •ë³´ ë°€ë„';
            }
            
            // ì—ë””í„° ì œëª© ì—…ë°ì´íŠ¸
            document.getElementById('editorTitle').textContent = 
                mode === 'color' ? 'ìƒ‰ìƒ ì½”ë“œ í¸ì§‘ê¸°' : 
                mode === 'ocr' ? 'OCR ì‹œë®¬ë ˆì´ì…˜' : 
                'í•˜ì´ë¸Œë¦¬ë“œ ì¸ì½”ë”©';
            
            generateIPv6();
        }

        // íŒ”ë ˆíŠ¸ ì´ˆê¸°í™”
        function initColorPalette() {
            const palette = document.getElementById('colorPalette');
            colors.forEach((color, index) => {
                const box = document.createElement('div');
                box.className = 'color-box';
                if (color.isBase) box.classList.add('base-color');
                box.style.background = color.hex;
                box.onclick = () => applyColor(index);
                palette.appendChild(box);
            });
        }

        // í…ìŠ¤íŠ¸ ì…ë ¥
        document.getElementById('textInput').addEventListener('input', (e) => {
            const text = e.target.value;
            textChars = text.split('').map((char, index) => ({
                char: char,
                colorIndex: index === 0 ? BASE_COLOR_INDEX : null,
                unicode: char.charCodeAt(0),
                isBase: index === 0
            }));
            renderColoredText();
            generateIPv6();
        });

        // ë Œë”ë§
        function renderColoredText() {
            const container = document.getElementById('coloredText');
            if (textChars.length === 0) {
                container.innerHTML = '<div style="color: var(--gov-gray); padding: 3rem;">ìœ„ì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</div>';
                return;
            }

            container.innerHTML = '';
            textChars.forEach((charObj, index) => {
                const span = document.createElement('span');
                span.className = `colored-char ${charObj.isBase ? 'base' : ''}`;
                span.textContent = charObj.char;
                
                if (currentMode === 'color' || currentMode === 'hybrid') {
                    if (charObj.colorIndex !== null) {
                        span.style.color = colors[charObj.colorIndex].hex;
                    } else {
                        span.style.color = '#CCCCCC';
                    }
                } else {
                    span.style.color = '#333333'; // OCR ëª¨ë“œëŠ” ìƒ‰ìƒ ì—†ìŒ
                }
                
                if (selectedCharIndex === index) {
                    span.style.border = '3px solid #FFD700';
                    span.style.borderRadius = '8px';
                    span.style.background = '#FFF9E6';
                }
                
                span.onclick = () => selectChar(index);
                container.appendChild(span);
            });
        }

        function selectChar(index) {
            if (index === 0 && currentMode !== 'ocr') {
                alert('ì²« ë²ˆì§¸ ê¸€ìëŠ” ê¸°ì¤€ ìƒ‰ìƒìœ¼ë¡œ ê³ ì •ë©ë‹ˆë‹¤.');
                return;
            }
            selectedCharIndex = index;
            renderColoredText();
        }

        function applyColor(colorIndex) {
            if (currentMode === 'ocr') {
                alert('OCR ëª¨ë“œì—ì„œëŠ” ìƒ‰ìƒì„ ì ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            if (selectedCharIndex === null || selectedCharIndex === 0) {
                alert('ìƒ‰ìƒì„ ì ìš©í•  ê¸€ìë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            textChars[selectedCharIndex].colorIndex = colorIndex;
            renderColoredText();
            generateIPv6();
        }

        // IPv6 ìƒì„±
        function generateIPv6() {
            if (textChars.length === 0) {
                document.getElementById('ipv6Output').innerHTML = '<div style="text-align: center; opacity: 0.5;">í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ë©´<br>IPv6 ì£¼ì†Œê°€ ìƒì„±ë©ë‹ˆë‹¤</div>';
                document.getElementById('addressBreakdown').innerHTML = '<div style="text-align: center; color: var(--gov-gray);">ì¸ì½”ë”© ìƒì„¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>';
                updateComparison();
                return;
            }

            const textValue = textChars.map(c => c.char).join('');
            let encoded = '';
            let encodingDetails = [];

            if (currentMode === 'color') {
                // ìƒ‰ìƒë§Œ ì¸ì½”ë”© (6ë¹„íŠ¸)
                textChars.forEach(charObj => {
                    const colorCode = (charObj.colorIndex !== null ? charObj.colorIndex : 0).toString(16).padStart(2, '0');
                    encoded += colorCode;
                    encodingDetails.push({
                        char: charObj.char,
                        color: colorCode,
                        unicode: null
                    });
                });
            } else if (currentMode === 'ocr') {
                // ìœ ë‹ˆì½”ë“œë§Œ ì¸ì½”ë”© (16ë¹„íŠ¸)
                textChars.forEach(charObj => {
                    const unicodeHex = charObj.unicode.toString(16).padStart(4, '0');
                    encoded += unicodeHex;
                    encodingDetails.push({
                        char: charObj.char,
                        color: null,
                        unicode: unicodeHex
                    });
                });
            } else {
                // í•˜ì´ë¸Œë¦¬ë“œ: ìƒ‰ìƒ(6ë¹„íŠ¸) + ìœ ë‹ˆì½”ë“œ(16ë¹„íŠ¸) = 22ë¹„íŠ¸
                textChars.forEach(charObj => {
                    const colorCode = (charObj.colorIndex !== null ? charObj.colorIndex : 0).toString(16).padStart(2, '0');
                    const unicodeHex = charObj.unicode.toString(16).padStart(4, '0');
                    encoded += colorCode + unicodeHex;
                    encodingDetails.push({
                        char: charObj.char,
                        color: colorCode,
                        unicode: unicodeHex
                    });
                });
            }

            // IPv6 ì£¼ì†Œ êµ¬ì„±
            const prefix = currentMode === 'hybrid' ? '2001:cc64:kr00:hyb' : 
                          currentMode === 'ocr' ? '2001:cc64:kr00:ocr' : 
                          '2001:cc64:kr00:col';
            
            const ipv6Compressed = `${prefix}::${encoded}`;
            
            document.getElementById('ipv6Output').innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <strong style="color: #10b981;">${currentMode.toUpperCase()} ëª¨ë“œ IPv6:</strong>
                </div>
                <div style="font-size: 1.5rem; line-height: 1.6; margin-bottom: 1rem;">
                    ${ipv6Compressed}
                </div>
                <div style="font-size: 0.875rem; color: #6ee7b7;">
                    ì¸ì½”ë”© ê¸¸ì´: ${encoded.length}ìë¦¬ (${encoded.length * 4}ë¹„íŠ¸)
                </div>
            `;

            // ì¸ì½”ë”© ìƒì„¸
            let breakdownHTML = '';
            encodingDetails.forEach((detail, idx) => {
                if (currentMode === 'color') {
                    breakdownHTML += `
                        <div class="breakdown-item">
                            <div class="breakdown-label">${detail.char}</div>
                            <div class="breakdown-value">ìƒ‰ìƒ: ${detail.color} (6ë¹„íŠ¸)</div>
                        </div>
                    `;
                } else if (currentMode === 'ocr') {
                    breakdownHTML += `
                        <div class="breakdown-item">
                            <div class="breakdown-label">${detail.char}</div>
                            <div class="breakdown-value">ìœ ë‹ˆì½”ë“œ: ${detail.unicode} (U+${detail.unicode.toUpperCase()}, 16ë¹„íŠ¸)</div>
                        </div>
                    `;
                } else {
                    breakdownHTML += `
                        <div class="breakdown-item">
                            <div class="breakdown-label">${detail.char}</div>
                            <div class="breakdown-value">ìƒ‰ìƒ: ${detail.color} + ìœ ë‹ˆì½”ë“œ: ${detail.unicode} (22ë¹„íŠ¸)</div>
                        </div>
                    `;
                }
            });

            document.getElementById('addressBreakdown').innerHTML = breakdownHTML;
            updateComparison();
        }

        // ë¹„êµí‘œ ì—…ë°ì´íŠ¸
        function updateComparison() {
            const charCount = textChars.length;
            if (charCount === 0) {
                document.getElementById('comparisonBody').innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--gov-gray);">í…ìŠ¤íŠ¸ ì…ë ¥ í›„ ë¹„êµ</td></tr>';
                return;
            }

            const colorOnly = Math.pow(64, charCount);
            const ocrOnly = Math.pow(65536, charCount); // 16ë¹„íŠ¸ = 65536ê°€ì§€
            const hybrid = Math.pow(4194304, charCount); // 22ë¹„íŠ¸ = 4,194,304ê°€ì§€

            document.getElementById('comparisonBody').innerHTML = `
                <tr style="background: ${currentMode === 'color' ? '#E8F0FF' : 'white'}">
                    <td><strong>ìƒ‰ìƒ ì „ìš©</strong></td>
                    <td>6ë¹„íŠ¸</td>
                    <td>${colorOnly.toLocaleString()}</td>
                </tr>
                <tr style="background: ${currentMode === 'ocr' ? '#E8F0FF' : 'white'}">
                    <td><strong>OCR ì „ìš©</strong></td>
                    <td>16ë¹„íŠ¸</td>
                    <td>${ocrOnly.toLocaleString()}</td>
                </tr>
                <tr style="background: ${currentMode === 'hybrid' ? '#E8F0FF' : 'white'}">
                    <td><strong>í•˜ì´ë¸Œë¦¬ë“œ</strong></td>
                    <td>22ë¹„íŠ¸</td>
                    <td><span class="highlight">${hybrid.toLocaleString()}</span></td>
                </tr>
            `;
        }


        // AI ìë™ ìƒ‰ìƒ í• ë‹¹
        async function autoColorByAI() {
            const text = document.getElementById('textInput').value;
            
            if (!text) {
                alert('ë¨¼ì € í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            if (currentMode === 'ocr') {
                alert('OCR ëª¨ë“œì—ì„œëŠ” ìƒ‰ìƒ í• ë‹¹ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }
            
            const aiBtn = document.getElementById('aiColorBtn');
            const originalHTML = aiBtn.innerHTML;
            aiBtn.disabled = true;
            aiBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> AI ë¶„ì„ ì¤‘...';
            
            try {
                const response = await fetch('/api/color-code/auto-color', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: text,
                        mode: currentMode
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // AIê°€ í• ë‹¹í•œ ìƒ‰ìƒ ì ìš©
                    textChars.forEach((charObj, index) => {
                        if (index < data.colors.length) {
                            charObj.colorIndex = data.colors[index];
                        }
                    });
                    
                    renderColoredText();
                    generateIPv6();
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    alert('âœ¨ AIê°€ ìƒ‰ìƒì„ ìë™ í• ë‹¹í–ˆìŠµë‹ˆë‹¤!\n\n' + data.reasoning);
                } else {
                    alert('âŒ AI ìƒ‰ìƒ í• ë‹¹ ì‹¤íŒ¨: ' + data.error);
                }
            } catch (error) {
                console.error('AI ìƒ‰ìƒ í• ë‹¹ ì˜¤ë¥˜:', error);
                alert('âŒ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            } finally {
                aiBtn.disabled = false;
                aiBtn.innerHTML = originalHTML;
            }
        }

        // ë³µì‚¬
        function copyIPv6() {
            if (textChars.length === 0) {
                alert('ë¨¼ì € í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê³  ì¸ì½”ë”©í•˜ì„¸ìš”.');
                return;
            }

            const ipv6Text = document.getElementById('ipv6Output').textContent.match(/2001:cc64:[a-z0-9:]+/i);
            if (ipv6Text) {
                navigator.clipboard.writeText(ipv6Text[0]).then(() => {
                    alert('âœ… IPv6 ì£¼ì†Œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\n' + ipv6Text[0]);
                });
            }
        }

        // ì´ˆê¸°í™”
        initColorPalette();
        
        // ì˜ˆì‹œ ìë™ ì…ë ¥
        setTimeout(() => {
            document.getElementById('textInput').value = 'ìƒˆë§ˆì„';
            document.getElementById('textInput').dispatchEvent(new Event('input'));
        }, 1000);
    </script>
</body>
</html>

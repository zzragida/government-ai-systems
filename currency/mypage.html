<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Page - EGCT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="common.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .profile-section { display: grid; grid-template-columns: 320px 1fr; gap: var(--space-lg); margin-bottom: var(--space-lg); }
        .profile-card { background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); overflow: hidden; }
        .profile-header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); padding: var(--space-xl); text-align: center; color: var(--white); }
        .profile-avatar { width: 80px; height: 80px; background: var(--white); border-radius: 50%; margin: 0 auto var(--space-md); display: flex; align-items: center; justify-content: center; font-size: 32px; color: var(--primary); }
        .profile-name { font-size: var(--font-xl); font-weight: 700; margin-bottom: var(--space-xs); }
        .profile-id { font-size: var(--font-sm); opacity: 0.85; }
        .profile-badge { display: inline-block; background: #ffc107; color: #000; padding: 4px 14px; border-radius: 20px; font-size: var(--font-sm); font-weight: 600; margin-top: var(--space-md); }
        .profile-body { padding: var(--space-lg); }
        .profile-row { display: flex; justify-content: space-between; padding: var(--space-md) 0; border-bottom: 1px solid var(--gray-200); font-size: var(--font-base); }
        .profile-row:last-child { border-bottom: none; }
        .profile-row .label { color: var(--gray-500); }
        .profile-row .value { font-weight: 600; color: var(--gray-900); }
        .asset-summary { background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-md); padding: var(--space-xl); }
        .asset-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--space-lg); }
        .asset-header h2 { font-size: var(--font-lg); color: var(--primary); }
        .asset-total { display: flex; align-items: baseline; gap: var(--space-md); margin-bottom: var(--space-xl); padding-bottom: var(--space-lg); border-bottom: 1px solid var(--gray-200); }
        .asset-total .amount { font-size: var(--font-xxl); font-weight: 700; color: var(--primary); }
        .asset-total .change { font-size: var(--font-base); padding: 6px 12px; border-radius: var(--radius-sm); }
        .asset-total .change.up { background: #e8f5e9; color: var(--success); }
        .asset-breakdown { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-lg); }
        .asset-item { text-align: center; padding: var(--space-lg); background: var(--gray-100); border-radius: var(--radius-md); }
        .asset-item .icon { font-size: 28px; color: var(--primary); margin-bottom: var(--space-sm); }
        .asset-item .label { font-size: var(--font-sm); color: var(--gray-500); margin-bottom: var(--space-xs); }
        .asset-item .value { font-size: var(--font-lg); font-weight: 700; color: var(--gray-900); }
        .asset-item .sub { font-size: var(--font-sm); color: var(--gray-500); margin-top: var(--space-xs); }
        .section-card { background: var(--white); border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); margin-bottom: var(--space-lg); }
        .section-card .header { padding: var(--space-md) var(--space-lg); border-bottom: 1px solid var(--gray-200); }
        .section-card .header h3 { font-size: var(--font-md); color: var(--primary); display: flex; align-items: center; gap: var(--space-sm); }
        .section-card .body { padding: var(--space-lg); }
        .portfolio-content { display: grid; grid-template-columns: 200px 1fr; gap: var(--space-lg); align-items: center; }
        .legend-item { display: flex; align-items: center; justify-content: space-between; padding: var(--space-md) 0; border-bottom: 1px solid var(--gray-200); }
        .legend-item:last-child { border-bottom: none; }
        .legend-left { display: flex; align-items: center; gap: var(--space-sm); }
        .legend-dot { width: 14px; height: 14px; border-radius: 4px; }
        .legend-name { font-size: var(--font-base); font-weight: 500; }
        .legend-right { text-align: right; }
        .legend-value { font-size: var(--font-base); font-weight: 600; }
        .legend-pct { font-size: var(--font-sm); color: var(--gray-500); }
        .quick-menu { display: grid; grid-template-columns: repeat(4, 1fr); gap: var(--space-md); }
        .quick-item { text-align: center; padding: var(--space-lg); background: var(--gray-100); border-radius: var(--radius-md); cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .quick-item:hover { background: #e3f2fd; }
        .quick-item i { font-size: 28px; color: var(--primary); margin-bottom: var(--space-sm); display: block; }
        .quick-item .label { font-size: var(--font-base); color: var(--gray-700); }
        .alert-item { display: flex; align-items: center; gap: var(--space-md); padding: var(--space-md); background: var(--gray-100); border-radius: var(--radius-md); margin-bottom: var(--space-sm); border-left: 3px solid var(--accent); }
        .alert-item i { font-size: 20px; color: var(--accent); }
        .alert-item .content { flex: 1; }
        .alert-item .title { font-size: var(--font-base); font-weight: 600; }
        .alert-item .desc { font-size: var(--font-sm); color: var(--gray-500); margin-top: 2px; }
        .alert-item .time { font-size: var(--font-sm); color: var(--gray-400); }
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: var(--space-md) 0; border-bottom: 1px solid var(--gray-200); }
        .setting-row:last-child { border-bottom: none; }
        .setting-info .title { font-size: var(--font-base); font-weight: 500; }
        .setting-info .desc { font-size: var(--font-sm); color: var(--gray-500); margin-top: 2px; }
        .toggle { width: 48px; height: 26px; background: var(--gray-300); border-radius: 13px; position: relative; cursor: pointer; transition: background 0.2s; }
        .toggle.on { background: var(--primary); }
        .toggle::after { content: ''; position: absolute; width: 22px; height: 22px; background: var(--white); border-radius: 50%; top: 2px; left: 2px; transition: left 0.2s; box-shadow: var(--shadow-sm); }
        .toggle.on::after { left: 24px; }
        .no-login { text-align: center; padding: 60px 20px; }
        .no-login i { font-size: 48px; color: #ccc; margin-bottom: 16px; }
        .no-login p { color: #666; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="top-header">
        <div class="top-header-inner" style="display:flex; justify-content:space-between; align-items:center;">
            <h1>EGCT 거래소</h1>
            <div class="header-buttons" style="display:flex; gap:12px;">
                <a href="http://100.30.14.224/portal/" class="header-btn" style="background:rgba(255,255,255,0.15); color:#fff; padding:8px 16px; border-radius:6px; text-decoration:none; font-size:14px; display:flex; align-items:center; gap:6px; transition:background 0.2s;"><i class="fas fa-question-circle"></i> 포털</a>
                <a href="http://100.30.14.224/openhash-system/" class="header-btn" style="background:rgba(255,255,255,0.15); color:#fff; padding:8px 16px; border-radius:6px; text-decoration:none; font-size:14px; display:flex; align-items:center; gap:6px; transition:background 0.2s;"><i class="fas fa-question-circle"></i> OpenHash</a>
            </div>
        </div>
    </div>
    <div class="tab-nav">
        <div class="tab-nav-inner">
            <a href="trading.html" class="tab"><i class="fas fa-exchange-alt"></i>EGCT 거래</a>
            <a href="hashchain-demo.html" class="tab"><i class="fas fa-link"></i>오픈해시</a>
            <a href="abdc.html" class="tab"><i class="fas fa-gem"></i>ABDC 화폐</a>
            <a href="pool.html" class="tab"><i class="fas fa-cubes"></i>자산 POOL</a>
            <a href="exchange.html" class="tab"><i class="fas fa-chart-line"></i>자산 거래소</a>
            <a href="holders.html" class="tab"><i class="fas fa-users"></i>EGCT 보유 현황</a>
            <a href="prices.html" class="tab"><i class="fas fa-chart-line"></i>가격 동향</a>
            <a href="mypage.html" class="tab active"><i class="fas fa-user-circle"></i>My Page</a>
            <a href="pdv.html" class="tab"><i class="fas fa-shield-halved"></i>My PDV</a>
        </div>
    </div>
    
    <div class="container" id="mainContent">
        <div class="profile-section">
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar"><i class="fas fa-user"></i></div>
                    <div class="profile-name" id="userName">-</div>
                    <div class="profile-id" id="userInfo">로그인 필요</div>
                    <div class="profile-badge"><i class="fas fa-crown"></i> VIP 회원</div>
                </div>
                <div class="profile-body">
                    <div class="profile-row"><span class="label">회원 등급</span><span class="value text-primary">VIP</span></div>
                    <div class="profile-row"><span class="label">가입일</span><span class="value">2024.06.15</span></div>
                    <div class="profile-row"><span class="label">최근 접속</span><span class="value" id="lastAccess">-</span></div>
                    <div class="profile-row"><span class="label">보안 등급</span><span class="value text-success"><i class="fas fa-shield-alt"></i> 높음</span></div>
                    <div class="profile-row"><span class="label">총 거래 건수</span><span class="value" id="txCount">0건</span></div>
                    <div class="profile-row"><span class="label">거래 수수료</span><span class="value">0.05% (VIP 할인)</span></div>
                </div>
            </div>
            
            <div class="asset-summary">
                <div class="asset-header">
                    <h2><i class="fas fa-wallet"></i> 자산 현황</h2>
                    <span class="text-muted text-sm" id="assetTime">-</span>
                </div>
                <div class="asset-total">
                    <span class="amount" id="totalAsset">₩0</span>
                    <span class="change up" id="assetChange"><i class="fas fa-arrow-up"></i> -</span>
                </div>
                <div class="asset-breakdown">
                    <div class="asset-item">
                        <div class="icon"><i class="fas fa-coins"></i></div>
                        <div class="label">보유 EGCT</div>
                        <div class="value" id="egctBalance">0 T</div>
                        <div class="sub" id="egctValue">₩0</div>
                    </div>
                    <div class="asset-item">
                        <div class="icon"><i class="fas fa-won-sign"></i></div>
                        <div class="label">보유 현금</div>
                        <div class="value" id="krwBalance">₩0</div>
                        <div class="sub">출금 가능</div>
                    </div>
                    <div class="asset-item">
                        <div class="icon"><i class="fas fa-chart-pie"></i></div>
                        <div class="label">총 거래액</div>
                        <div class="value" id="totalTraded">₩0</div>
                        <div class="sub" id="tradedCount">0건</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="grid-2 mb-lg">
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-chart-pie"></i> 포트폴리오 구성</h3></div>
                <div class="body">
                    <div class="portfolio-content">
                        <div class="chart-container sm"><canvas id="portfolioChart"></canvas></div>
                        <div class="portfolio-legend" id="portfolioLegend"></div>
                    </div>
                </div>
            </div>
            
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-history"></i> 최근 거래 내역</h3></div>
                <div class="body">
                    <table class="data-table">
                        <thead><tr><th>일시</th><th>구분</th><th>수량</th><th>단가</th><th>금액</th></tr></thead>
                        <tbody id="recentTxBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="grid-3">
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-th-large"></i> 빠른 메뉴</h3></div>
                <div class="body">
                    <div class="quick-menu">
                        <a href="trading.html" class="quick-item"><i class="fas fa-exchange-alt"></i><div class="label">거래하기</div></a>
                        <a href="pdv.html" class="quick-item"><i class="fas fa-shield-halved"></i><div class="label">My PDV</div></a>
                        <a href="holders.html" class="quick-item"><i class="fas fa-users"></i><div class="label">보유현황</div></a>
                        <a href="prices.html" class="quick-item"><i class="fas fa-chart-line"></i><div class="label">가격동향</div></a>
                    </div>
                </div>
            </div>
            
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-bell"></i> 최근 알림</h3></div>
                <div class="body" id="alertList"></div>
            </div>
            
            <div class="section-card">
                <div class="header"><h3><i class="fas fa-cog"></i> 설정</h3></div>
                <div class="body">
                    <div class="setting-row"><div class="setting-info"><div class="title">가격 알림</div><div class="desc">목표가 도달 시 알림</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                    <div class="setting-row"><div class="setting-info"><div class="title">체결 알림</div><div class="desc">주문 체결 시 알림</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                    <div class="setting-row"><div class="setting-info"><div class="title">2단계 인증</div><div class="desc">로그인 시 OTP 인증</div></div><div class="toggle on" onclick="this.classList.toggle('on')"></div></div>
                </div>
            </div>
        </div>
    </div>

<script>
(function() {
    var EGCT_PRICE = 1005;
    
    // 사용자 정보 로드
    var user = JSON.parse(localStorage.getItem('egct_user') || 'null');
    var egctBalance = parseInt(localStorage.getItem('egct_balance')) || 0;
    var krwBalance = parseInt(localStorage.getItem('egct_krw')) || 0;
    var transactions = JSON.parse(localStorage.getItem('egct_pdv_transactions') || '[]');
    
    // 프로필 업데이트
    if (user) {
        document.getElementById('userName').textContent = user.displayName || user.name || user.id;
        document.getElementById('userInfo').textContent = user.id + ' · ' + (user.email || 'user@egct.io');
    }
    
    document.getElementById('lastAccess').textContent = new Date().toLocaleString('ko-KR');
    document.getElementById('txCount').textContent = transactions.length + '건';
    
    // 자산 현황
    var egctValue = egctBalance * EGCT_PRICE;
    var totalAsset = egctValue + krwBalance;
    
    document.getElementById('assetTime').textContent = new Date().toLocaleString('ko-KR') + ' 기준';
    document.getElementById('totalAsset').textContent = '₩' + totalAsset.toLocaleString();
    document.getElementById('egctBalance').textContent = egctBalance.toLocaleString() + ' T';
    document.getElementById('egctValue').textContent = '₩' + egctValue.toLocaleString();
    document.getElementById('krwBalance').textContent = '₩' + krwBalance.toLocaleString();
    
    // 총 거래액 계산
    var totalTraded = 0;
    for (var i = 0; i < transactions.length; i++) {
        totalTraded += transactions[i].value || (transactions[i].amount * transactions[i].price);
    }
    document.getElementById('totalTraded').textContent = '₩' + totalTraded.toLocaleString();
    document.getElementById('tradedCount').textContent = transactions.length + '건';
    
    // 포트폴리오 비율
    var egctPct = totalAsset > 0 ? ((egctValue / totalAsset) * 100).toFixed(1) : 0;
    var krwPct = totalAsset > 0 ? ((krwBalance / totalAsset) * 100).toFixed(1) : 0;
    
    document.getElementById('portfolioLegend').innerHTML = 
        '<div class="legend-item"><div class="legend-left"><div class="legend-dot" style="background:#003566;"></div><span class="legend-name">EGCT</span></div><div class="legend-right"><div class="legend-value">' + egctBalance.toLocaleString() + ' T</div><div class="legend-pct">' + egctPct + '%</div></div></div>' +
        '<div class="legend-item"><div class="legend-left"><div class="legend-dot" style="background:#0077cc;"></div><span class="legend-name">KRW</span></div><div class="legend-right"><div class="legend-value">₩' + krwBalance.toLocaleString() + '</div><div class="legend-pct">' + krwPct + '%</div></div></div>';
    
    // 최근 거래 내역
    var txHtml = '';
    var recentTx = transactions.slice(-5).reverse();
    if (recentTx.length === 0) {
        txHtml = '<tr><td colspan="5" style="text-align:center;color:#999;padding:20px;">거래 내역이 없습니다</td></tr>';
    } else {
        for (var i = 0; i < recentTx.length; i++) {
            var tx = recentTx[i];
            var badgeClass = tx.type === 'BUY' ? 'badge-success' : 'badge-danger';
            var typeLabel = tx.type === 'BUY' ? '매수' : '매도';
            var time = new Date(tx.timestamp).toLocaleString('ko-KR', {month:'numeric',day:'numeric',hour:'2-digit',minute:'2-digit'});
            var value = tx.value || (tx.amount * tx.price);
            txHtml += '<tr><td>' + time + '</td><td><span class="badge ' + badgeClass + '">' + typeLabel + '</span></td><td class="num">' + tx.amount.toLocaleString() + ' T</td><td class="num">₩' + tx.price.toLocaleString() + '</td><td class="num">₩' + value.toLocaleString() + '</td></tr>';
        }
    }
    document.getElementById('recentTxBody').innerHTML = txHtml;
    
    // 알림
    var alertHtml = '';
    if (recentTx.length > 0) {
        for (var i = 0; i < Math.min(recentTx.length, 3); i++) {
            var tx = recentTx[i];
            var icon = tx.type === 'BUY' ? 'fa-arrow-down' : 'fa-arrow-up';
            var color = tx.type === 'BUY' ? '#2e7d32' : '#c62828';
            var label = tx.type === 'BUY' ? '매수 체결' : '매도 등록';
            var time = new Date(tx.timestamp).toLocaleTimeString('ko-KR', {hour:'2-digit',minute:'2-digit'});
            alertHtml += '<div class="alert-item"><i class="fas ' + icon + '" style="color:' + color + ';"></i><div class="content"><div class="title">' + label + '</div><div class="desc">' + tx.amount + ' T @ ₩' + tx.price.toLocaleString() + '</div></div><div class="time">' + time + '</div></div>';
        }
    } else {
        alertHtml = '<div style="text-align:center;color:#999;padding:20px;">알림이 없습니다</div>';
    }
    document.getElementById('alertList').innerHTML = alertHtml;
    
    // 포트폴리오 차트
    new Chart(document.getElementById('portfolioChart'), {
        type: 'doughnut',
        data: {
            labels: ['EGCT', 'KRW'],
            datasets: [{ data: [parseFloat(egctPct), parseFloat(krwPct)], backgroundColor: ['#003566', '#0077cc'], borderWidth: 0 }]
        },
        options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { display: false } } }
    });
})();
</script>
</body>
</html>

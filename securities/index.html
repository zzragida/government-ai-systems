<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>오픈해시 자율 증권 시스템 | OpenHash 기반 차세대 금융</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React 18 -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Recharts 의존성 -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'sec-blue': '#003D82',
                        'sec-blue-light': '#0052A3',
                        'sec-green': '#00A651',
                        'sec-red': '#DC3545',
                        'sec-gold': '#D4AF37',
                        'sec-gray': '#6C757D',
                        'gov-border': '#DEE2E6'
                    },
                    fontFamily: {
                        sans: ['Noto Sans KR', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes slideDown {
            from { 
                opacity: 0; 
                transform: translateY(-20px);
                max-height: 0;
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
                max-height: 2000px;
            }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-slideDown { 
            animation: slideDown 0.3s ease-out forwards;
        }
        .animate-fadeIn { 
            animation: fadeIn 0.5s ease-out;
        }
        * { 
            font-family: 'Noto Sans KR', sans-serif; 
        }
        body { 
            background-color: #F8F9FA; 
        }
        .tab-active {
            background: linear-gradient(135deg, #003D82 0%, #0052A3 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 61, 130, 0.3);
        }
        .tab-inactive {
            background: white;
            color: #003D82;
            border: 2px solid #E5E7EB;
        }
        .tab-inactive:hover {
            background: #F3F4F6;
            border-color: #003D82;
        }
    </style>
</head>
<body>

    <!-- 데모 배너 -->
        <div style="background:#4B5563;color:white;padding:12px;display:flex;justify-content:space-between;align-items:center;">
        <p style="font-size:14px;font-weight:600;margin:0;">⚠️ 본 사이트는 OpenHash 기술의 실증을 위한 데모 시스템입니다 (실제 정부 서비스 아님)</p>
        <div style="display:flex;gap:20px;">
            <a href="http://100.30.14.224/openhash-system/" style="color:white;text-decoration:none;font-size:14px;font-weight:600;display:flex;align-items:center;gap:4px;">
                <span>Openhash</span>
                <i class="fas fa-question-circle" style="font-size:16px;"></i>
            </a>
            <a href="http://100.30.14.224/national-data-registry/" style="color:white;text-decoration:underline;font-size:14px;font-weight:600;">국가 데이터처</a>
        </div>
    </div>
    <div id="root"></div>

    <!-- Recharts 로딩 확인 스크립트 -->
    <script>
        // Recharts가 로드될 때까지 대기
        function waitForRecharts(callback) {
            if (window.Recharts) {
                callback();
            } else {
                setTimeout(() => waitForRecharts(callback), 100);
            }
        }
    </script>

    <!-- Common Components -->
    <script type="text/babel" src="/securities/js/common/StatCard.js"></script>
    <script type="text/babel" src="/securities/js/common/FeatureCard.js"></script>
    <script type="text/babel" src="/securities/js/common/ComparisonChart.js"></script>

    <!-- Layout Components -->
    <script type="text/babel" src="/securities/js/components/Header.js"></script>
    <script type="text/babel" src="/securities/js/components/Footer.js"></script>

    <!-- Tab Components -->
    <script type="text/babel" src="/securities/js/components/Overview.js"></script>
    <script type="text/babel" src="/securities/js/components/CreditRating.js"></script>
    <script type="text/babel" src="/securities/js/components/SmartTrading.js"></script>
    <script type="text/babel" src="/securities/js/components/SecuritiesIssuance.js"></script>
    <script type="text/babel" src="/securities/js/components/InvestmentAnalysis.js"></script>
    <script type="text/babel" src="/securities/js/components/PortfolioMgmt.js"></script>
    <script type="text/babel" src="/securities/js/components/RiskManagement.js"></script>
    <script type="text/babel" src="/securities/js/components/Compliance.js"></script>
    <script type="text/babel" src="/securities/js/components/BackOffice.js"></script>
    <script type="text/babel" src="/securities/js/components/IBSupport.js"></script>
    <script type="text/babel" src="/securities/js/components/PerformanceDashboard.js"></script>

    <!-- Main App -->
    <script type="text/babel" src="/securities/js/app.js"></script>
    <!-- Floating Button & Modal included below -->
</body>

    <!-- Floating AI Consultation Button -->
    <button id="aiConsultBtn" class="fixed bottom-8 right-8 w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 text-white rounded-full shadow-2xl hover:scale-110 transition-all duration-300 z-50 flex items-center justify-center group">
        <i class="fas fa-question text-2xl"></i>
        <span class="absolute bottom-full right-0 mb-2 px-3 py-1 bg-gray-900 text-white text-sm rounded-lg opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap">
            AI 상담
        </span>
    </button>

    <!-- AI Consultation Modal -->
    <div id="aiConsultModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-2xl flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-bold mb-1">AI 금융 상담</h2>
                    <p class="text-sm opacity-90">Claude AI가 증권 관련 질문에 답변해 드립니다</p>
                </div>
                <button id="closeModal" class="text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-colors">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <!-- Chat Messages -->
            <div id="chatMessages" class="flex-1 overflow-y-auto p-6 space-y-4">
                <div class="flex items-start gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-robot text-white"></i>
                    </div>
                    <div class="bg-gray-100 rounded-2xl rounded-tl-none p-4 max-w-[80%]">
                        <p class="text-gray-800">안녕하세요! 증권, 투자, 신용평가 등 금융 관련 질문을 자유롭게 해주세요. 오픈해시 PDV 시스템에 대해서도 상담해 드립니다.</p>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="border-t border-gray-200 p-6 bg-gray-50 rounded-b-2xl">
                <div class="flex gap-3">
                    <input 
                        type="text" 
                        id="userInput" 
                        placeholder="질문을 입력하세요..."
                        class="flex-1 px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:border-blue-500 transition-colors"
                        onkeypress="if(event.key === 'Enter') sendMessage()"
                    />
                    <button 
                        onclick="sendMessage()" 
                        class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all duration-300 font-semibold"
                    >
                        <i class="fas fa-paper-plane mr-2"></i>
                        전송
                    </button>
                </div>
                <div class="mt-3 text-xs text-gray-500 flex items-center gap-2">
                    <i class="fas fa-shield-alt text-blue-500"></i>
                    <span>Claude AI (Sonnet 4.5)로 구동됩니다</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Claude API Script -->
    <script>
        // Modal 제어
        const modal = document.getElementById('aiConsultModal');
        const btn = document.getElementById('aiConsultBtn');
        const closeBtn = document.getElementById('closeModal');
        
        btn.onclick = () => {
            modal.classList.remove('hidden');
            document.getElementById('userInput').focus();
        };
        
        closeBtn.onclick = () => modal.classList.add('hidden');
        
        modal.onclick = (e) => {
            if (e.target === modal) modal.classList.add('hidden');
        };

        // 메시지 전송
        let conversationHistory = [];
        
        async function sendMessage() {
            const input = document.getElementById('userInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // 사용자 메시지 추가
            addMessage(message, 'user');
            input.value = '';
            
            // 로딩 표시
            const loadingId = addMessage('답변을 생성하는 중...', 'assistant', true);
            
            try {
                // 백엔드 API 호출 (CORS 우회)
                const response = await fetch('/securities-api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        messages: [
                            ...conversationHistory,
                            { role: 'user', content: message }
                        ]
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                const assistantMessage = data.content;
                
                // 대화 히스토리에 추가
                conversationHistory.push(
                    { role: 'user', content: message },
                    { role: 'assistant', content: assistantMessage }
                );
                
                // 로딩 메시지 제거하고 실제 답변 추가
                removeMessage(loadingId);
                addMessage(assistantMessage, 'assistant');
                
            } catch (error) {
                console.error('Error:', error);
                removeMessage(loadingId);
                addMessage('죄송합니다. 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\n\n오류 내용: ' + error.message, 'assistant', false, true);
            }
        }
        
        function addMessage(text, role, isLoading = false, isError = false) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageId = 'msg-' + Date.now();
            
            const messageDiv = document.createElement('div');
            messageDiv.id = messageId;
            messageDiv.className = 'flex items-start gap-3 ' + (role === 'user' ? 'flex-row-reverse' : '');
            
            const avatarDiv = document.createElement('div');
            if (role === 'user') {
                avatarDiv.className = 'w-10 h-10 bg-gradient-to-br from-green-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0';
                avatarDiv.innerHTML = '<i class="fas fa-user text-white"></i>';
            } else {
                avatarDiv.className = 'w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center flex-shrink-0';
                avatarDiv.innerHTML = '<i class="fas fa-robot text-white"></i>';
            }
            
            const textDiv = document.createElement('div');
            textDiv.className = role === 'user' 
                ? 'bg-gradient-to-br from-blue-600 to-purple-600 text-white rounded-2xl rounded-tr-none p-4 max-w-[80%]'
                : (isError ? 'bg-red-100 text-red-800 rounded-2xl rounded-tl-none p-4 max-w-[80%]' : 'bg-gray-100 rounded-2xl rounded-tl-none p-4 max-w-[80%]');
            
            const textP = document.createElement('p');
            textP.className = isError ? 'text-red-800' : (role === 'user' ? 'text-white' : 'text-gray-800');
            textP.style.whiteSpace = 'pre-wrap';
            textP.textContent = text;
            
            if (isLoading) {
                textP.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>' + text;
            }
            
            textDiv.appendChild(textP);
            messageDiv.appendChild(avatarDiv);
            messageDiv.appendChild(textDiv);
            messagesDiv.appendChild(messageDiv);
            
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            
            return messageId;
        }
        
        function removeMessage(messageId) {
            const element = document.getElementById(messageId);
            if (element) element.remove();
        }
    </script>

                    />
                    <button 
                        onclick="sendMessage()" 
                        class="px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all duration-300 font-semibold"
                    >
                        <i class="fas fa-paper-plane mr-2"></i>
                        전송
                    </button>
                </div>
                <div class="mt-3 text-xs text-gray-500 flex items-center gap-2">
                    <i class="fas fa-shield-alt text-blue-500"></i>
                    <span>Claude AI (Sonnet 4.5)로 구동됩니다</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Claude API Script -->
        }
    </script>
</html>
